<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arbeitssicherheit-Checkliste-2025</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link href="/sicher/favicon.ico" rel="icon" type="image/x-icon" />
  <link href="/sicher/manifest.json" rel="manifest"/>
  <style>
    /* Allgemeine Stile */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f5f5f5;
        padding: 15px;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .wrapper-rahmen {
        background-color: #ffffff;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 24px;
        max-width: 1400px;
        margin: auto;
    }

    header {
        margin-bottom: 20px;
    }

    header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        color: #212529;
    }

    .form-section {
        background: #f8f9fa;
        padding: 25px;
        margin-bottom: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .form-section label {
        font-weight: 600;
        margin-bottom: 5px;
        color: #2d3748;
    }

    .form-section input[type="text"],
    .form-section input[type="date"] {
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.2s ease;
        -webkit-appearance: none;
        width: 100%;
        max-width: 300px;
    }

    .form-section input[type="text"]:focus,
    .form-section input[type="date"]:focus {
        outline: none;
        border-color: #667eea;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .category-frame {
        background: #f8f9fa;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
        overflow: hidden;
    }

    .category-title {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        font-size: 1.4em;
        font-weight: 600;
        margin-bottom: 15px;
    }

    .question-item {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        transition: background-color 0.2s ease;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    /* Alternating background colors for question items */
    .question-item:nth-child(odd) {
        background-color: #f7fafc; /* Light grey */
    }
    .question-item:nth-child(even) {
        background-color: #ffffff; /* White */
    }

    .question-item:last-child {
        border-bottom: none;
    }

    .question-item:hover {
        background-color: #eef2f7; /* Slightly darker hover for both */
    }

    .question-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start; /* Align items to the start for consistent radio button alignment */
        flex-wrap: wrap;
        gap: 15px;
    }

    .question-text {
        font-weight: 600;
        color: #2d3748;
        font-size: 1em;
        flex-grow: 1;
    }

    .radio-group {
        display: flex;
        flex-direction: column; /* Always stack radio options vertically */
        align-items: flex-start; /* Align radio options to the left */
        gap: 8px; /* Smaller gap between stacked options */
    }

    .radio-option {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 10px 15px; /* Slightly reduced padding for stacked options */
        border-radius: 25px;
        transition: background-color 0.2s ease;
        min-height: 44px;
        touch-action: manipulation;
        width: 100%; /* Make radio options take full width when stacked */
        justify-content: flex-start; /* Align content to the left within option */
    }

    .radio-option:hover, .radio-option:active {
        background-color: #e2e8f0;
    }

    .radio-option input[type="radio"] {
        margin: 0;
        transform: scale(1.5);
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border: 2px solid #cbd5e0;
        border-radius: 50%;
        position: relative;
    }

    .radio-option input[type="radio"]:checked {
        border-color: #667eea;
    }

    .radio-option input[type="radio"]:checked::after {
        content: '';
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #667eea;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .radio-option.yes { color: #38a169; }
    .radio-option.no { color: #e53e3e; }
    .radio-option.na { color: #718096; }

    .measure-display {
        background: #fff5f5;
        color: #e53e3e;
        padding: 10px 15px;
        border-radius: 6px;
        border-left: 3px solid #e53e3e;
        font-size: 0.95em;
        font-weight: 500;
        margin-top: 5px;
    }

    /* Maßnahmen-Tabelle */
    #maßnahmen-tabelle {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background-color: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        border-radius: 12px;
        overflow: hidden;
    }

    #maßnahmen-tabelle th {
        background-color: #e53e3e;
        color: white;
        padding: 12px;
        text-align: left;
    }

    #maßnahmen-tabelle td {
        padding: 10px;
        border: 1px solid #dee2e6;
        text-align: left;
    }

    #maßnahmen-tabelle tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    /* Bestätigungsbereich */
    .confirmation-section {
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 24px;
        max-width: 700px;
        margin: 40px auto;
    }

    .checkbox-row {
        display: flex;
        gap: 40px;
        margin-top: 16px;
        justify-content: space-between;
    }

    .checkbox-column {
        display: flex;
        flex-direction: column;
        gap: 12px;
        flex: 1;
    }

    .confirmation-section label {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Buttons */
    button.custom-btn,
    button.btn-large,
    button.btn-medium {
        font-size: 16px;
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        margin: 10px auto;
        display: block;
        font-family: inherit;
        transition: all 0.3s ease;
    }

    button.btn-large { width: 600px; }
    button.btn-medium { width: 280px; }

    button.btn-blue { background-color: #007bff; color: white; }
    button.btn-green { background-color: #28a745; color: white; }
    button.btn-gray { background-color: #6c757d; color: white; }

    button.custom-btn:hover,
    button.btn-large:hover,
    button.btn-medium:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }

    /* Unterschrift */
    .signature-container {
        position: relative;
        max-width: 600px;
        margin: 0 auto 20px auto;
    }

    #signature-pad {
        border: 2px solid #ddd;
        border-radius: 16px;
        width: 100%;
        height: 150px;
        touch-action: none;
        display: block;
        background: white;
    }

    .signature-container label {
        position: absolute;
        top: 8px;
        left: 12px;
        background: white;
        padding: 0 6px;
        font-weight: bold;
        font-size: 14px;
        color: #212529;
        pointer-events: none;
        user-select: none;
        z-index: 10;
    }

    /* Auswertung */
    #auswertung-container {
        margin-top: 40px;
        background: #edf2f7;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        display: none; /* Initially hidden */
    }

    #auswertung h3 {
        color: #2d3748;
        margin-bottom: 15px;
    }

    #auswertung p {
        margin-bottom: 8px;
    }

    /* Footer */
    footer {
        text-align: center;
        margin-top: 40px;
        padding: 16px 8px;
        font-size: 12px;
        color: #999;
        background-color: #fafafa;
        border-top: 1px solid #eee;
        border-radius: 0 0 10px 10px;
    }

    /* Responsive Adjustments */
    @media screen and (max-width: 1024px) {
        body {
            padding: 10px;
        }
        header h1 {
            font-size: 2em;
        }
        .form-section input[type="text"],
        .form-section input[type="date"] {
            max-width: 100%;
        }
        .info-grid {
            grid-template-columns: 1fr; /* Stack info fields vertically on smaller screens */
        }
        /* Radio group already stacks vertically due to global rule */
        button.btn-large,
        button.btn-medium,
        button.custom-btn {
            width: 100%;
            max-width: 100%;
            margin-left: 0;
            margin-right: 0;
        }
        .buttons {
            flex-direction: column;
            gap: 10px;
        }
        .signature-container {
            max-width: 100%;
        }
    }

    @media screen and (max-width: 768px) {
        header h1 {
            font-size: 1.8em;
        }
        .category-title {
            font-size: 1.2em;
        }
        .question-text {
            font-size: 0.95em;
        }
        .form-section, .confirmation-section, .category-frame {
            padding: 15px;
        }
        .checkbox-row {
            flex-direction: column;
            gap: 15px;
        }
        #signature-pad {
            height: 120px;
        }
    }

    /* Print styles */
    @media print {
        body {
            line-height: 1.2; /* Reduced line height for print */
            font-size: 10pt; /* Smaller base font size for print */
            background: white;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .page-break-before {
            page-break-before: always;
            margin-top: 0;
            break-before: page;
        }
        @page {
            size: A4 portrait;
            margin: 15mm; /* Slightly reduced margins for more content */
        }
        button, .btn, footer, .footer, .action-buttons, .signature-controls, .no-print {
            display: none !important;
        }
        input[type="text"], input[type="date"] {
            border: none;
            background: transparent;
            font-weight: bold;
            color: black;
        }
        input[type="radio"] {
            transform: scale(1.2);
        }
        .category-title {
            background-color: #d1ecf1 !important; /* Light blue for print */
            color: #0c5460 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .question-item {
            background-color: white !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            page-break-inside: avoid; /* Prevent breaking inside question item */
        }
        .category-frame {
            page-break-inside: avoid; /* Prevent breaking inside category frame */
        }
        #maßnahmen-tabelle th {
            background-color: #e53e3e !important;
            color: white !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        #maßnahmen-tabelle tr:nth-child(even) {
            background-color: #f2f2f2 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .measure-display {
            display: block !important; /* Ensure measures are visible in print */
            background: #fff5f5 !important;
            color: #e53e3e !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .signature-container label {
            background: transparent !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        #signature-pad {
            border: 2px solid #000 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .question-text, #maßnahmen-tabelle td {
            line-height: 1.3; /* Specific line height for text content */
        }
    }
  </style>
</head>
<body>
  <div class="wrapper-rahmen">
    <div class="print-wrapper">
      <header>
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
          <h1 style="margin: 0;">Arbeitssicherheit-Checkliste-2025</h1>
          <input id="datum" type="date" style="padding: 8px; font-size: 16px;" />
        </div>
      </header>

      <div class="form-section">
        <h2>Allgemeine Informationen</h2>
        <div class="info-grid">
          <div class="form-group">
            <label for="markt">Marktnummer:</label>
            <input type="text" id="markt" placeholder="z. B. M123" required>
          </div>
          <div class="form-group">
            <label for="name">Name:</label>
            <input id="name" type="text" placeholder="Name eingeben"/>
          </div>
          <div class="form-group">
            <label for="sifa">SiFa:</label>
            <input id="sifa" type="text" placeholder="SIFA eingeben"/>
          </div>
        </div>
      </div>

      <div style="text-align: center; margin: 40px 0; font-size: 20px;">
        <strong>Teil der Gefährdungsbeurteilung / Wirksamkeitskontrolle</strong><br/>
        Wenn eine Frage mit „nein“ beantwortet wurde, besteht Handlungsbedarf.
      </div>

      <div id="questions-container">
        <!-- 1.0 Gesamtmarkt -->
        <div class="category-frame">
          <h3 class="category-title">1.0 Gesamtmarkt</h3>
          <div class="question-item" data-question-id="1">
            <div class="question-row">
              <div class="question-text">Tragen alle Personen im Markt festes, geschlossenes und flaches Schuhwerk entsprechend den Vorgaben?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-1" value="ja" onchange="handleAnswer(1, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-1" value="nein" onchange="handleAnswer(1, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-1" value="nicht_vorhanden" onchange="handleAnswer(1, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-1" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="2">
            <div class="question-row">
              <div class="question-text">Sind an den Automatiktüren, Rolltoren und Schnelllauftoren keine sichtbaren Beschädigungen erkennbar?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-2" value="ja" onchange="handleAnswer(2, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-2" value="nein" onchange="handleAnswer(2, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-2" value="nicht_vorhanden" onchange="handleAnswer(2, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-2" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="3">
            <div class="question-row">
              <div class="question-text">Ist die Aufzugsanlage geprüft und in einem ordnungsgemäßen Zustand (ohne sichtbare Beschädigungen und mit funktionsfähigen Schutzeinrichtungen)?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-3" value="ja" onchange="handleAnswer(3, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-3" value="nein" onchange="handleAnswer(3, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-3" value="nicht_vorhanden" onchange="handleAnswer(3, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-3" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="4">
            <div class="question-row">
              <div class="question-text">Ist die Leergutrücknahme in einem ordnungsgemäßen Zustand (Schutzeinrichtungen intakt, Einzugsstellen gesichert, keine Glasscherben)?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-4" value="ja" onchange="handleAnswer(4, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-4" value="nein" onchange="handleAnswer(4, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-4" value="nicht_vorhanden" onchange="handleAnswer(4, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-4" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="5">
            <div class="question-row">
              <div class="question-text">Sind die Leitern geprüft gemäß „Leitern und Tritte“ (BGV D 36) bzw. GUV-VD360?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-5" value="ja" onchange="handleAnswer(5, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-5" value="nein" onchange="handleAnswer(5, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-5" value="nicht_vorhanden" onchange="handleAnswer(5, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-5" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="6">
            <div class="question-row">
              <div class="question-text">Werden aus dem Ordersatz geeignete Sicherheitsmesser verwendet?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-6" value="ja" onchange="handleAnswer(6, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-6" value="nein" onchange="handleAnswer(6, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-6" value="nicht_vorhanden" onchange="handleAnswer(6, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-6" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="7">
            <div class="question-row">
              <div class="question-text">Sind zur Zeit der Begehung keine sichtbaren Beschädigungen an Schaltern und Steckdosen vorhanden?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-7" value="ja" onchange="handleAnswer(7, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-7" value="nein" onchange="handleAnswer(7, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-7" value="nicht_vorhanden" onchange="handleAnswer(7, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-7" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="8">
            <div class="question-row">
              <div class="question-text">Ist der Gabelhubwagen in einem ordnungsgemäßen Zustand ohne sichtbare Beschädigungen?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-8" value="ja" onchange="handleAnswer(8, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-8" value="nein" onchange="handleAnswer(8, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-8" value="nicht_vorhanden" onchange="handleAnswer(8, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-8" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="9">
            <div class="question-row">
              <div class="question-text">Ist der elektrische Hubwagen geprüft und in einem ordnungsgemäßen Zustand (keine sichtbaren Beschädigungen, funktionsfähige Schutzeinrichtungen)?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-9" value="ja" onchange="handleAnswer(9, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-9" value="nein" onchange="handleAnswer(9, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-9" value="nicht_vorhanden" onchange="handleAnswer(9, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-9" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="10">
            <div class="question-row">
              <div class="question-text">Sind die Feuerlöscheinrichtungen frei zugänglich und nicht durch Ware, Displays oder sonstige Gegenstände blockiert?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-10" value="ja" onchange="handleAnswer(10, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-10" value="nein" onchange="handleAnswer(10, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-10" value="nicht_vorhanden" onchange="handleAnswer(10, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-10" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="11">
            <div class="question-row">
              <div class="question-text">Sind die Feuerlöscheinrichtungen geprüft, und werden die Prüffristen eingehalten?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-11" value="ja" onchange="handleAnswer(11, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-11" value="nein" onchange="handleAnswer(11, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-11" value="nicht_vorhanden" onchange="handleAnswer(11, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-11" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="12">
            <div class="question-row">
              <div class="question-text">Befinden sich keine Gegenstände im Bereich der Brandschutztüren, und ist deren Funktionsfähigkeit vollständig gewährleistet?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-12" value="ja" onchange="handleAnswer(12, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-12" value="nein" onchange="handleAnswer(12, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-12" value="nicht_vorhanden" onchange="handleAnswer(12, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-12" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="13">
            <div class="question-row">
              <div class="question-text">Sind die Türhaltevorrichtungen und der Schließfolgeregler des Feuerschutzabschlusses in Ordnung?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-13" value="ja" onchange="handleAnswer(13, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-13" value="nein" onchange="handleAnswer(13, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-13" value="nicht_vorhanden" onchange="handleAnswer(13, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-13" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="51">
            <div class="question-row">
              <div class="question-text">Sind die Schwerlastregale geprüft?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-51" value="ja" onchange="handleAnswer(51, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-51" value="nein" onchange="handleAnswer(51, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-51" value="nicht_vorhanden" onchange="handleAnswer(51, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-51" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="52">
            <div class="question-row">
              <div class="question-text">Ist der Anfahrschutz vorhanden?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-52" value="ja" onchange="handleAnswer(52, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-52" value="nein" onchange="handleAnswer(52, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-52" value="nicht_vorhanden" onchange="handleAnswer(52, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-52" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="53">
            <div class="question-row">
              <div class="question-text">Ist die Traglastangabe an den Schwerlastregalen vorhanden?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-53" value="ja" onchange="handleAnswer(53, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-53" value="nein" onchange="handleAnswer(53, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-53" value="nicht_vorhanden" onchange="handleAnswer(53, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-53" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="54">
            <div class="question-row">
              <div class="question-text">Befindet sich eine Absturzsicherung an der Rampe?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-54" value="ja" onchange="handleAnswer(54, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-54" value="nein" onchange="handleAnswer(54, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-54" value="nicht_vorhanden" onchange="handleAnswer(54, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-54" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="55">
            <div class="question-row">
              <div class="question-text">Ist die Absturzsicherung in einem ordnungsgemäßen Zustand (ohne sichtbare Beschädigungen und mit Kennzeichnung)?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-55" value="ja" onchange="handleAnswer(55, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-55" value="nein" onchange="handleAnswer(55, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-55" value="nicht_vorhanden" onchange="handleAnswer(55, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-55" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="56">
            <div class="question-row">
              <div class="question-text">Ist die Müll-/Papierpresse geprüft?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-56" value="ja" onchange="handleAnswer(56, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-56" value="nein" onchange="handleAnswer(56, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-56" value="nicht_vorhanden" onchange="handleAnswer(56, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-56" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="57">
            <div class="question-row">
              <div class="question-text">Ist die Müll-/Papierpresse in einem ordnungsgemäßen Zustand (keine sichtbaren Beschädigungen, intakte Schutzeinrichtungen, fester Stand)?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-57" value="ja" onchange="handleAnswer(57, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-57" value="nein" onchange="handleAnswer(57, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-57" value="nicht_vorhanden" onchange="handleAnswer(57, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-57" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="58">
            <div class="question-row">
              <div class="question-text">Sind die Verkehrswege so beschaffen, dass kein Risiko zum Stolpern, Ausrutschen oder Umknicken besteht?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-58" value="ja" onchange="handleAnswer(58, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-58" value="nein" onchange="handleAnswer(58, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-58" value="nicht_vorhanden" onchange="handleAnswer(58, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-58" style="display: none;"></div>
          </div>
        </div>

        <!-- 7.0 Sozialräume -->
        <div class="category-frame">
          <h3 class="category-title">7.0 Sozialräume</h3>
          <div class="question-item" data-question-id="59">
            <div class="question-row">
              <div class="question-text">Hängen im Sozialbereich die aktuellen aushangpflichtigen Gesetze, Unfallverhütungsvorschriften sowie die Brandschutzordnung Teil A aus?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-59" value="ja" onchange="handleAnswer(59, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-59" value="nein" onchange="handleAnswer(59, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-59" value="nicht_vorhanden" onchange="handleAnswer(59, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-59" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="60">
            <div class="question-row">
              <div class="question-text">Sind die Kaffeemaschine und andere hitzeentwickelnde Geräte auf einer nicht brennbaren Unterlage abgestellt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-60" value="ja" onchange="handleAnswer(60, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-60" value="nein" onchange="handleAnswer(60, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-60" value="nicht_vorhanden" onchange="handleAnswer(60, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-60" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="61">
            <div class="question-row">
              <div class="question-text">Ist der Erste-Hilfe-Koffer gut sichtbar an einer geeigneten Stelle montiert?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-61" value="ja" onchange="handleAnswer(61, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-61" value="nein" onchange="handleAnswer(61, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-61" value="nicht_vorhanden" onchange="handleAnswer(61, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-61" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="62">
            <div class="question-row">
              <div class="question-text">Werden ortsveränderliche elektrische Betriebsmittel (z. B. Leitungen, Steckverbindungen, Leuchten, Geräte) in angemessenen Zeitabständen geprüft?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-62" value="ja" onchange="handleAnswer(62, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-62" value="nein" onchange="handleAnswer(62, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-62" value="nicht_vorhanden" onchange="handleAnswer(62, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-62" style="display: none;"></div>
          </div>
        </div>

        <!-- 8.0 Marktleiterbüro -->
        <div class="category-frame">
          <h3 class="category-title">8.0 Marktleiterbüro</h3>
          <div class="question-item" data-question-id="63">
            <div class="question-row">
              <div class="question-text">Liegt eine aktuelle Liste sowie Prüfberichte prüfungsbedürftiger Einrichtungen vor?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-63" value="ja" onchange="handleAnswer(63, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-63" value="nein" onchange="handleAnswer(63, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-63" value="nicht_vorhanden" onchange="handleAnswer(63, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-63" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="64">
            <div class="question-row">
              <div class="question-text">Ist der Verbandskasten in einem ordnungsgemäßen Zustand?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-64" value="ja" onchange="handleAnswer(64, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-64" value="nein" onchange="handleAnswer(64, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-64" value="nicht_vorhanden" onchange="handleAnswer(64, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-64" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="65">
            <div class="question-row">
              <div class="question-text">Wird die "Dokumentation Erste Hilfeleistungen" geführt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-65" value="ja" onchange="handleAnswer(65, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-65" value="nein" onchange="handleAnswer(65, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-65" value="nicht_vorhanden" onchange="handleAnswer(65, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-65" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="66">
            <div class="question-row">
              <div class="question-text">Sind Maßnahmen getroffen, die den Anreiz zu Raubüberfällen vermindern (z. B. Türspion, feststehender Knauf)?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-66" value="ja" onchange="handleAnswer(66, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-66" value="nein" onchange="handleAnswer(66, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-66" value="nicht_vorhanden" onchange="handleAnswer(66, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-66" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="67">
            <div class="question-row">
              <div class="question-text">Ist die Tür während des Umgangs mit Zahlungsmitteln verschlossen?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-67" value="ja" onchange="handleAnswer(67, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-67" value="nein" onchange="handleAnswer(67, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-67" value="nicht_vorhanden" onchange="handleAnswer(67, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-67" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="68">
            <div class="question-row">
              <div class="question-text">Werden neue Mitarbeiter vor Aufnahme der Tätigkeit zum Thema Arbeitssicherheit und Brandschutz unterwiesen?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-68" value="ja" onchange="handleAnswer(68, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-68" value="nein" onchange="handleAnswer(68, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-68" value="nicht_vorhanden" onchange="handleAnswer(68, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-68" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="69">
            <div class="question-row">
              <div class="question-text">Ist während der gesamten Ladenöffnungszeit mindestens ein Mitarbeiter mit der Qualifikation zum Ersthelfer anwesend?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-69" value="ja" onchange="handleAnswer(69, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-69" value="nein" onchange="handleAnswer(69, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-69" value="nicht_vorhanden" onchange="handleAnswer(69, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-69" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="70">
            <div class="question-row">
              <div class="question-text">Ist während der gesamten Ladenöffnungszeit mindestens ein Mitarbeiter mit der Qualifikation als Brandschutzhelfer anwesend?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-70" value="ja" onchange="handleAnswer(70, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-70" value="nein" onchange="handleAnswer(70, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-70" value="nicht_vorhanden" onchange="handleAnswer(70, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-70" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="71">
            <div class="question-row">
              <div class="question-text">Ist ein Sicherheitsbeauftragter ausgebildet und bestellt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-71" value="ja" onchange="handleAnswer(71, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-71" value="nein" onchange="handleAnswer(71, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-71" value="nicht_vorhanden" onchange="handleAnswer(71, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-71" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="72">
            <div class="question-row">
              <div class="question-text">Wurde die Gefährdungsbeurteilung (GBO) erstellt und ist sie auf dem aktuellen Stand?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-72" value="ja" onchange="handleAnswer(72, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-72" value="nein" onchange="handleAnswer(72, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-72" value="nicht_vorhanden" onchange="handleAnswer(72, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-72" style="display: none;"></div>
          </div>
        </div>

        <!-- 9.0 CO2 Kühleinrichtungen -->
        <div class="category-frame">
          <h3 class="category-title">9.0 CO2 Kühleinrichtungen</h3>
          <div class="question-item" data-question-id="73">
            <div class="question-row">
              <div class="question-text">Wurden Personen, die sich im Bereich von Kühlanlagen oder Kühlhäusern aufhalten, unterwiesen?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-73" value="ja" onchange="handleAnswer(73, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-73" value="nein" onchange="handleAnswer(73, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-73" value="nicht_vorhanden" onchange="handleAnswer(73, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-73" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="74">
            <div class="question-row">
              <div class="question-text">Sind die Sensoren nicht mit Material oder sonstigen Gegenständen verstellt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-74" value="ja" onchange="handleAnswer(74, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-74" value="nein" onchange="handleAnswer(74, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-74" value="nicht_vorhanden" onchange="handleAnswer(74, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-74" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="75">
            <div class="question-row">
              <div class="question-text">Sind alle Sicherheitsvorrichtungen (Alarmleuchten, Kennzeichnungen, Kühlhaustüren) intakt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-75" value="ja" onchange="handleAnswer(75, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-75" value="nein" onchange="handleAnswer(75, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-75" value="nicht_vorhanden" onchange="handleAnswer(75, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-75" style="display: none;"></div>
          </div>
        </div>

        <!-- 10.0 Praktikanten -->
        <div class="category-frame">
          <h3 class="category-title">10.0 Praktikanten</h3>
          <div class="question-item" data-question-id="76">
            <div class="question-row">
              <div class="question-text">Wurde die Unterweisung von Praktikanten und Schüleraushilfen durchgeführt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-76" value="ja" onchange="handleAnswer(76, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-76" value="nein" onchange="handleAnswer(76, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-76" value="nicht_vorhanden" onchange="handleAnswer(76, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-76" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="77">
            <div class="question-row">
              <div class="question-text">Wurde die Unterweisung schriftlich dokumentiert?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-77" value="ja" onchange="handleAnswer(77, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-77" value="nein" onchange="handleAnswer(77, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-77" value="nicht_vorhanden" onchange="handleAnswer(77, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-77" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="78">
            <div class="question-row">
              <div class="question-text">Haben die Personen die Inhalte der Unterweisung verstanden?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-78" value="ja" onchange="handleAnswer(78, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-78" value="nein" onchange="handleAnswer(78, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-78" value="nicht_vorhanden" onchange="handleAnswer(78, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-78" style="display: none;"></div>
          </div>
        </div>

        <!-- 11.0 Arbeitsmedizin -->
        <div class="category-frame">
          <h3 class="category-title">11.0 Arbeitsmedizin</h3>
          <div class="question-item" data-question-id="79">
            <div class="question-row">
              <div class="question-text">Wird den Beschäftigten arbeitsmedizinische Vorsorge angeboten?
</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-79" value="ja" onchange="handleAnswer(79, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-79" value="nein" onchange="handleAnswer(79, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-79" value="nicht_vorhanden" onchange="handleAnswer(79, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-79" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="80">
            <div class="question-row">
              <div class="question-text">Sind Maßnahmen gegen Hauterkrankungen getroffen?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-80" value="ja" onchange="handleAnswer(80, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-80" value="nein" onchange="handleAnswer(80, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-80" value="nicht_vorhanden" onchange="handleAnswer(80, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-80" style="display: none;"></div>
          </div>
        </div>

        <!-- 12.0 Psychische Belastung -->
        <div class="category-frame">
          <h3 class="category-title">12.0 Psychische Belastung</h3>
          <div class="question-item" data-question-id="81">
            <div class="question-row">
              <div class="question-text">Werden Wünsche der Beschäftigten bei der Arbeitsplanung berücksichtigt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-81" value="ja" onchange="handleAnswer(81, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-81" value="nein" onchange="handleAnswer(81, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-81" value="nicht_vorhanden" onchange="handleAnswer(81, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-81" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="82">
            <div class="question-row">
              <div class="question-text">Ist die Pausenregelung umgesetzt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-82" value="ja" onchange="handleAnswer(82, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-82" value="nein" onchange="handleAnswer(82, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-82" value="nicht_vorhanden" onchange="handleAnswer(82, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-82" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="83">
            <div class="question-row">
              <div class="question-text">Ist ein Pausenraum vorhanden?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-83" value="ja" onchange="handleAnswer(83, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-83" value="nein" onchange="handleAnswer(83, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-83" value="nicht_vorhanden" onchange="handleAnswer(83, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-83" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="84">
            <div class="question-row">
              <div class="question-text">Werden Überstunden gering gehalten?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-84" value="ja" onchange="handleAnswer(84, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-84" value="nein" onchange="handleAnswer(84, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-84" value="nicht_vorhanden" onchange="handleAnswer(84, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-84" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="85">
            <div class="question-row">
              <div class="question-text">Werden regelmäßige Teambesprechungen durchgeführt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-85" value="ja" onchange="handleAnswer(85, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-85" value="nein" onchange="handleAnswer(85, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-85" value="nicht_vorhanden" onchange="handleAnswer(85, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-85" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="86">
            <div class="question-row">
              <div class="question-text">Werden neue Mitarbeiter eingearbeitet?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-86" value="ja" onchange="handleAnswer(86, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-86" value="nein" onchange="handleAnswer(86, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-86" value="nicht_vorhanden" onchange="handleAnswer(86, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-86" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="87">
            <div class="question-row">
              <div class="question-text">Ist eine Unterweisung zum Thema Brand- und Arbeitsschutz erfolgt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-87" value="ja" onchange="handleAnswer(87, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-87" value="nein" onchange="handleAnswer(87, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-87" value="nicht_vorhanden" onchange="handleAnswer(87, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-87" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="88">
            <div class="question-row">
              <div class="question-text">Hängt ein sogenanntes schwarzes Brett im Sozialraum oder Kassenbüro?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-88" value="ja" onchange="handleAnswer(88, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-88" value="nein" onchange="handleAnswer(88, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-88" value="nicht_vorhanden" onchange="handleAnswer(88, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-88" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="89">
            <div class="question-row">
              <div class="question-text">Werden Entscheidungen transparent erläutert?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-89" value="ja" onchange="handleAnswer(89, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-89" value="nein" onchange="handleAnswer(89, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-89" value="nicht_vorhanden" onchange="handleAnswer(89, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-89" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="90">
            <div class="question-row">
              <div class="question-text">Gibt es positive Rückmeldungen bei guter Leistung?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-90" value="ja" onchange="handleAnswer(90, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-90" value="nein" onchange="handleAnswer(90, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-90" value="nicht_vorhanden" onchange="handleAnswer(90, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-90" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="91">
            <div class="question-row">
              <div class="question-text">Wird konstruktive Kritik geübt?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-91" value="ja" onchange="handleAnswer(91, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-91" value="nein" onchange="handleAnswer(91, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-91" value="nicht_vorhanden" onchange="handleAnswer(91, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-91" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="92">
            <div class="question-row">
              <div class="question-text">Wurden Weiterbildungsmöglichkeiten geschaffen bzw. angeboten?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-92" value="ja" onchange="handleAnswer(92, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-92" value="nein" onchange="handleAnswer(92, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-92" value="nicht_vorhanden" onchange="handleAnswer(92, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-92" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="93">
            <div class="question-row">
              <div class="question-text">Gibt es einen Aushang zur Information über die Suchtprävention?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-93" value="ja" onchange="handleAnswer(93, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-93" value="nein" onchange="handleAnswer(93, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-93" value="nicht_vorhanden" onchange="handleAnswer(93, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-93" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="94">
            <div class="question-row">
              <div class="question-text">Ist ein betriebliches Wiedereingliederungsmanagement implementiert?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-94" value="ja" onchange="handleAnswer(94, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-94" value="nein" onchange="handleAnswer(94, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-94" value="nicht_vorhanden" onchange="handleAnswer(94, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-94" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="95">
            <div class="question-row">
              <div class="question-text">Wird Alleinarbeit vermieden?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-95" value="ja" onchange="handleAnswer(95, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-95" value="nein" onchange="handleAnswer(95, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-95" value="nicht_vorhanden" onchange="handleAnswer(95, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-95" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="96">
            <div class="question-row">
              <div class="question-text">Ist die Betreuung nach einem Überfall organisiert?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-96" value="ja" onchange="handleAnswer(96, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-96" value="nein" onchange="handleAnswer(96, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-96" value="nicht_vorhanden" onchange="handleAnswer(96, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-96" style="display: none;"></div>
          </div>
          <div class="question-item" data-question-id="97">
            <div class="question-row">
              <div class="question-text">Werden Schulungen für den Umgang mit gewalttätigen Situationen ermöglicht?</div>
              <div class="radio-group">
                <label class="radio-option yes">
                  <input type="radio" name="question-97" value="ja" onchange="handleAnswer(97, 'ja')"/>
                  <span>Ja</span>
                </label>
                <label class="radio-option no">
                  <input type="radio" name="question-97" value="nein" onchange="handleAnswer(97, 'nein')"/>
                  <span>Nein</span>
                </label>
                <label class="radio-option na">
                  <input type="radio" name="question-97" value="nicht_vorhanden" onchange="handleAnswer(97, 'nicht_vorhanden')"/>
                  <span>Nicht vorhanden</span>
                </label>
              </div>
            </div>
            <div class="measure-display" id="measure-display-97" style="display: none;"></div>
          </div>
        </div>
      </div>

      <br>
      <div style="display: flex; justify-content: center; gap: 16px; margin: 20px 0; flex-wrap: wrap;">
        <button onclick="neinFragenInMaßnahmen()" class="btn-medium btn-gray">⛔ Nein-Fragen automatisch einfügen</button>
        <button onclick="neinAntwortenEinfügenUndÖffnen()" class="btn-medium btn-gray">📝 „Nein“-Antworten übernehmen & anzeigen</button>
      </div>
      <br>
      <h2 class="page-break-before" style="text-align: center;">
        Beschreibung der Maßnahmen zur Beseitigung von Defiziten
      </h2>
      <br>

      <table id="maßnahmen-tabelle">
        <thead>
          <tr>
            <th>Nr.</th>
            <th>Beschreibung</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1</td><td contenteditable="true"></td></tr>
          <tr><td>2</td><td contenteditable="true"></td></tr>
          <tr><td>3</td><td contenteditable="true"></td></tr>
          <tr><td>4</td><td contenteditable="true"></td></tr>
          <tr><td>5</td><td contenteditable="true"></td></tr>
          <tr><td>6</td><td contenteditable="true"></td></tr>
          <tr><td>7</td><td contenteditable="true"></td></tr>
          <tr><td>8</td><td contenteditable="true"></td></tr>
          <tr><td>9</td><td contenteditable="true"></td></tr>
          <tr><td>10</td><td contenteditable="true"></td></tr>
          <tr><td>11</td><td contenteditable="true"></td></tr>
          <tr><td>12</td><td contenteditable="true"></td></tr>
          <tr><td>13</td><td contenteditable="true"></td></tr>
          <tr><td>14</td><td contenteditable="true"></td></tr>
          <tr><td>15</td><td contenteditable="true"></td></tr>
        </tbody>
      </table>
      <div class="page-break-before confirmation-section">
        <h2>Abschlussbestätigung</h2>
        <div class="checkbox-row">
          <div class="checkbox-column">
            <label for="mangel">
              <input type="checkbox" id="mangel"/>
              <span>Alle Mängel wurden zur Kenntnis genommen.</span>
            </label>
            <label for="massnahmen">
              <input type="checkbox" id="massnahmen"/>
              <span>Maßnahmen gemäß Plan werden umgesetzt.</span>
            </label>
          </div>
          <div class="checkbox-column">
            <label for="nachkontrolle">
              <input type="checkbox" id="nachkontrolle"/>
              <span>Nachkontrolle wird durchgeführt.</span>
            </label>
            <label for="mitarbeiter">
              <input type="checkbox" id="mitarbeiter"/>
              <span>Mitarbeiter wurden informiert.</span>
            </label>
          </div>
        </div>
      </div>

      <div>
        <div class="signature-container">
          <label>Unterschrift</label>
          <canvas id="signature-pad"></canvas>
        </div>
        
        <button onclick="clearSignature()" class="btn-large btn-gray">
          🗑️ Unterschrift löschen
        </button>

        <div class="buttons" style="display: flex; justify-content: center; gap: 20px; max-width: 600px; margin: 0 auto 40px auto; flex-wrap: wrap;">
          <button onclick="auswertungAnzeigen()" class="btn-medium btn-gray">
            📊 Auswerten
          </button>
          <button onclick="prepareForPrint()" class="btn-medium btn-gray">
            📄 Drucken / PDF
          </button>
        </div>

        <button id="sharePdfButton" onclick="generatePdfAndPrepareShare()" class="custom-btn" style="background-color: #28a745;">
          📤 PDF teilen (iPad)
        </button>
        <span id="pdfStatusMessage" style="margin-left: 10px; color: #666;"></span>

        <div id="auswertung-container" style="display: none;">
          <div id="auswertung"></div>
        </div>
        <footer style="
          text-align: center;
          margin-top: 40px;
          padding: 16px 8px;
          font-size: 12px;
          color: #999;
          background-color: #fafafa;
          border-top: 1px solid #eee;
          border-radius: 0 0 10px 10px;">
          &copy; 2025 Andreas Zott – Alle Rechte vorbehalten<br>
          <span style="font-size: 11px;">(Sifa) Arbeitssicherheit 2025</span>
        </footer>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // Maßnahmen-Definitionen für alle Fragen (wie zuvor)
    const measures = {
        1: { text: "Schuhwerk-Richtlinien durchsetzen und Mitarbeiter über korrekte Arbeitsschuhe informieren", priority: "medium" },
        2: { text: "Türen und Tore durch Fachfirma reparieren lassen und regelmäßige Wartung sicherstellen", priority: "high" },
        3: { text: "Aufzug durch zertifizierten Sachverständigen prüfen lassen und Reparaturen durchführen", priority: "high" },
        4: { text: "Leergutrücknahme-Anlage instand setzen, Schutzeinrichtungen reparieren und Glasscherben entfernen", priority: "high" },
        5: { text: "Leitern durch Sachkundigen prüfen lassen und Prüfprotokoll erstellen", priority: "medium" },
        6: { text: "Geeignete Sicherheitsmesser aus dem Ordersatz beschaffen und Verwendung schulen", priority: "medium" },
        7: { text: "Beschädigte Schalter und Steckdosen durch Elektrofachkraft reparieren lassen", priority: "high" },
        8: { text: "Gabelhubwagen reparieren oder ersetzen und regelmäßige Wartung durchführen", priority: "medium" },
        9: { text: "Elektrischen Hubwagen durch Sachverständigen prüfen lassen und Reparaturen durchführen", priority: "high" },
        10: { text: "Zugangswege zu Feuerlöscheinrichtungen freiräumen und dauerhaft freihalten", priority: "high" },
        11: { text: "Feuerlöscheinrichtungen durch Fachfirma prüfen lassen und Prüffristen einhalten", priority: "high" },
        12: { text: "Brandschutztüren freiräumen und Mitarbeiter über Freihaltung schulen", priority: "high" },
        13: { text: "Türhaltevorrichtungen und Schließfolgeregler durch Fachfirma reparieren lassen", priority: "high" },
        14: { text: "Beschädigte Brandschutztüren durch Fachfirma reparieren oder ersetzen lassen", priority: "high" },
        15: { text: "Aktuellen Flucht- und Rettungsplan erstellen und gut sichtbar aushängen", priority: "high" },
        16: { text: "Defekte Notausgangsbeleuchtung reparieren und regelmäßige Funktionsprüfung durchführen", priority: "high" },
        17: { text: "Notausgänge freiräumen und dauerhaft freihalten, Mitarbeiter schulen", priority: "high" },
        18: { text: "Notausgänge entriegeln, Öffnungsmechanismus prüfen und Zugänglichkeit sicherstellen", priority: "high" },
        19: { text: "Fluchtwegeführung überprüfen und sichere Sammelpunkte definieren", priority: "high" },
        20: { text: "Verkehrswege instand setzen, rutschfeste Beläge anbringen und Stolperstellen beseitigen", priority: "medium" },
        21: { text: "Treppen reparieren, freiräumen und regelmäßige Kontrolle durchführen", priority: "medium" },
        22: { text: "Geeignete PSA beschaffen und Mitarbeiter in der Verwendung schulen", priority: "high" },
        23: { text: "Brennbares Material aus Technik- und Heizräumen entfernen und Lagerverbot durchsetzen", priority: "high" },
        24: { text: "Technik- und Heizräume räumen und alternative Lagermöglichkeiten schaffen", priority: "high" },
        25: { text: "Betriebsanweisungen aktualisieren, gut sichtbar aushängen und Einhaltung kontrollieren", priority: "medium" },
        27: { text: "Arbeitsgeräte der Backstation warten und reparieren lassen", priority: "medium" },
        28: { text: "Handwaschbecken reparieren oder ersetzen", priority: "medium" },
        29: { text: "Elektroleitungen durch Fachkraft prüfen und ordnungsgemäß verlegen lassen", priority: "high" },
        30: { text: "Zuleitung durch Elektrofachkraft VDE-konform erneuern lassen", priority: "high" },
        31: { text: "Neue Backhandschuhe mit langer Stulpe beschaffen", priority: "medium" },
        32: { text: "Heißgeräte durch Fachfirma warten und reparieren lassen", priority: "high" },
        33: { text: "Hautschutzplan erstellen und gut sichtbar aushängen", priority: "medium" },
        34: { text: "Hautschutz- und Hautpflegeprodukte beschaffen und bereitstellen", priority: "medium" },
        35: { text: "Arbeitsgeräte im Servicebereich warten und reparieren lassen", priority: "medium" },
        36: { text: "Glastüren und Glaswände in Augenhöhe mit Sicherheitsmarkierungen versehen", priority: "medium" },
        37: { text: "Farbcodierte Schneidbretter und Messer beschaffen und Reinigungsplan erstellen", priority: "medium" },
        38: { text: "Schneidbretter mit Messereinschub beschaffen", priority: "low" },
        39: { text: "Geeignete Messerhalter beschaffen und installieren", priority: "low" },
        40: { text: "Convenience-Geräte warten und reparieren lassen", priority: "medium" },
        41: { text: "Fußraum an den Kassen freiräumen und Ordnung halten", priority: "low" },
        42: { text: "Fußboden im Kassenbereich reparieren oder erneuern", priority: "medium" },
        43: { text: "Brennbares Material von Heizgeräten entfernen und Sicherheitsabstand einhalten", priority: "high" },
        44: { text: "Defekte Kassenstühle reparieren oder ersetzen", priority: "low" },
        45: { text: "Transportband reparieren oder ersetzen, Lücken schließen", priority: "medium" },
        46: { text: "Überglocken an der Kühlhausbeleuchtung installieren", priority: "medium" },
        47: { text: "Notentriegelung installieren oder reparieren und Funktion prüfen", priority: "high" },
        48: { text: "Rettungswegschilder ISO 7010 an Kühlhaustüren anbringen", priority: "high" },
        49: { text: "Kühlhausbeleuchtung reparieren und regelmäßige Wartung durchführen", priority: "medium" },
        50: { text: "Notruf-Funktion reparieren und regelmäßige Funktionsprüfung durchführen", priority: "high" },
        51: { text: "Schwerlastregale durch Sachverständigen prüfen lassen", priority: "high" },
        52: { text: "Anfahrschutz für Regale installieren", priority: "medium" },
        53: { text: "Traglastangaben an allen Schwerlastregalen anbringen", priority: "medium" },
        54: { text: "Absturzsicherung an der Rampe installieren", priority: "high" },
        55: { text: "Absturzsicherung reparieren und ordnungsgemäß kennzeichnen", priority: "high" },
        56: { text: "Müll-/Papierpresse durch Sachverständigen prüfen lassen", priority: "medium" },
        57: { text: "Müll-/Papierpresse reparieren und Schutzeinrichtungen instand setzen", priority: "medium" },
        58: { text: "Verkehrswege im Lager instand setzen und Stolperstellen beseitigen", priority: "medium" },
        59: { text: "Aktuelle aushangpflichtige Unterlagen beschaffen und aushängen", priority: "medium" },
        60: { text: "Nicht brennbare Unterlagen für hitzeentwickelnde Geräte beschaffen", priority: "medium" },
        61: { text: "Erste-Hilfe-Koffer gut sichtbar und zugänglich montieren", priority: "high" },
        62: { text: "Prüfung ortsveränderlicher elektrischer Betriebsmittel durch Elektrofachkraft veranlassen", priority: "medium" },
        63: { text: "Aktuelle Liste und Prüfberichte erstellen und führen", priority: "medium" },
        64: { text: "Verbandskasten auffüllen und regelmäßig kontrollieren", priority: "high" },
        65: { text: "Dokumentation für Erste Hilfeleistungen einführen und führen", priority: "medium" },
        66: { text: "Sicherheitsmaßnahmen gegen Raubüberfälle installieren (Türspion, Sicherheitsknauf)", priority: "high" },
        67: { text: "Verfahren für sicheren Umgang mit Zahlungsmitteln etablieren und schulen", priority: "high" },
        68: { text: "Unterweisungsprogramm für neue Mitarbeiter zu Arbeitssicherheit und Brandschutz erstellen", priority: "high" },
        69: { text: "Ersthelfer ausbilden lassen und Anwesenheit während Öffnungszeiten sicherstellen", priority: "high" },
        70: { text: "Brandschutzhelfer ausbilden lassen und Anwesenheit während Öffnungszeiten sicherstellen", priority: "high" },
        71: { text: "Sicherheitsbeauftragten ausbilden lassen und offiziell bestellen", priority: "medium" },
        72: { text: "Gefährdungsbeurteilung erstellen oder aktualisieren", priority: "high" },
        73: { text: "Unterweisung für Personen im Bereich von CO2-Kühlanlagen durchführen", priority: "high" },
        74: { text: "CO2-Sensoren freiräumen und regelmäßige Kontrolle durchführen", priority: "high" },
        75: { text: "Sicherheitsvorrichtungen der CO2-Anlage reparieren und regelmäßig prüfen", priority: "high" },
        76: { text: "Unterweisungsprogramm für Praktikanten und Schüleraushilfen erstellen und durchführen", priority: "medium" },
        77: { text: "Dokumentationssystem für Unterweisungen einführen", priority: "medium" },
        78: { text: "Verständniskontrolle bei Unterweisungen durchführen und dokumentieren", priority: "medium" },
        79: { text: "Arbeitsmedizinische Vorsorge organisieren und Mitarbeitern anbieten", priority: "medium" },
        80: { text: "Präventionsmaßnahmen gegen Hauterkrankungen implementieren", priority: "medium" },
        81: { text: "Mitarbeiterwünsche systematisch in Arbeitsplanung einbeziehen", priority: "low" },
        82: { text: "Pausenregelung überarbeiten und konsequent umsetzen", priority: "medium" },
        83: { text: "Geeigneten Pausenraum einrichten", priority: "medium" },
        84: { text: "Überstundenmanagement implementieren und Überstunden reduzieren", priority: "medium" },
        85: { text: "Regelmäßige Teambesprechungen einführen und durchführen", priority: "low" },
        86: { text: "Strukturiertes Einarbeitungsprogramm für neue Mitarbeiter entwickeln", priority: "medium" },
        87: { text: "Unterweisung zu Brand- und Arbeitsschutz durchführen und dokumentieren", priority: "high" },
        88: { text: "Schwarzes Brett für Mitarbeiterinformationen installieren", priority: "low" },
        89: { text: "Kommunikationsprozess für transparente Entscheidungserläuterung etablieren", priority: "low" },
        90: { text: "System für positive Leistungsrückmeldungen einführen", priority: "low" },
        91: { text: "Schulung für Führungskräfte in konstruktiver Kritik durchführen", priority: "low" },
        92: { text: "Weiterbildungsprogramm für Mitarbeiter entwickeln und anbieten", priority: "low" },
        93: { text: "Informationsmaterial zur Suchtprävention aushängen", priority: "low" },
        94: { text: "Betriebliches Wiedereingliederungsmanagement einführen", priority: "medium" },
        95: { text: "Arbeitsorganisation überprüfen und Alleinarbeit minimieren", priority: "medium" },
        96: { text: "Betreuungskonzept für Überfallsituationen entwickeln", priority: "high" },
        97: { text: "Schulungen für Umgang mit gewalttätigen Situationen organisieren", priority: "medium" }
    };

    let answers = {}; // Speichert die Antworten {questionId: 'ja'|'nein'|'nicht_vorhanden'}
    let generatedPdfFile = null; // Speichert die generierte PDF-Datei für das Teilen

    // Signatur-Canvas Setup
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    function resizeCanvas() {
      const ratio = window.devicePixelRatio || 1;
      const displayWidth = canvas.offsetWidth;
      const displayHeight = canvas.offsetHeight;
      const oldImage = new Image();
      oldImage.src = canvas.toDataURL();

      canvas.width = displayWidth * ratio;
      canvas.height = displayHeight * ratio;
      canvas.style.width = displayWidth + "px";
      canvas.style.height = displayHeight + "px";

      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.scale(ratio, ratio);

      oldImage.onload = () => {
        ctx.drawImage(oldImage, 0, 0, displayWidth, displayHeight);
      };
    }

    function getX(e) {
      return e.touches ? e.touches[0].clientX - canvas.getBoundingClientRect().left :
                         e.clientX - canvas.getBoundingClientRect().left;
    }

    function getY(e) {
      return e.touches ? e.touches[0].clientY - canvas.getBoundingClientRect().top :
                       e.clientY - canvas.getBoundingClientRect().top;
    }

    function startDrawing(e) {
      e.preventDefault(); // Verhindert Scrollen auf Touch-Geräten
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(getX(e), getY(e));
    }

    function draw(e) {
      if (!drawing) return;
      e.preventDefault(); // Verhindert Scrollen auf Touch-Geräten
      ctx.lineTo(getX(e), getY(e));
      ctx.stroke();
    }

    function stopDrawing() {
      drawing = false;
      saveSignature();
    }

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      localStorage.removeItem("signatureImage");
    }

    function saveSignature() {
      const dataURL = canvas.toDataURL();
      localStorage.setItem("signatureImage", dataURL);
    }

    function restoreSignature() {
      const dataURL = localStorage.getItem("signatureImage");
      if (dataURL) {
        const image = new Image();
        image.onload = () => {
          ctx.drawImage(image, 0, 0, canvas.offsetWidth, canvas.offsetHeight);
        };
        image.src = dataURL;
      }
    }

    function handleAnswer(questionId, answer) {
        answers[questionId] = answer;
        const measureDisplay = document.getElementById(`measure-display-${questionId}`);
        
        if (answer === 'nein') {
            const measureData = measures[questionId];
            if (measureDisplay && measureData) {
                const priorityText = {
                    'high': 'Hoch',
                    'medium': 'Mittel',
                    'low': 'Niedrig'
                };
                measureDisplay.innerHTML = `<strong>Maßnahme:</strong> ${measureData.text} <span style="background-color: ${measureData.priority === 'high' ? '#fed7d7' : measureData.priority === 'medium' ? '#feebc8' : '#c6f6d5'}; color: ${measureData.priority === 'high' ? '#c53030' : measureData.priority === 'medium' ? '#dd6b20' : '#2f855a'}; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 600;">${priorityText[measureData.priority]}</span>`;
                measureDisplay.style.display = 'block';
            }
        } else {
            if (measureDisplay) {
                measureDisplay.style.display = 'none';
                measureDisplay.innerHTML = '';
            }
        }
    }

    function prepareForPrint() {
      // Temporarily replace canvas with image for printing
      const dataURL = canvas.toDataURL();
      const img = document.createElement("img");
      img.src = dataURL;
      img.style.border = "2px solid #000";
      img.style.width = "100%";
      img.style.maxWidth = "600px";
      img.id = "signature-image-for-print"; // Add ID for easy removal
      canvas.style.display = 'none'; // Hide original canvas
      canvas.parentNode.insertBefore(img, canvas); // Insert image before canvas

      window.print();

      // Restore canvas after printing (using a timeout to ensure print dialog closes)
      setTimeout(() => {
        const printImg = document.getElementById("signature-image-for-print");
        if (printImg) {
          printImg.remove();
        }
        canvas.style.display = 'block'; // Show original canvas again
      }, 1000); // Adjust timeout if needed
    }

    function auswertungAnzeigen() {
      const answeredQuestions = Object.keys(answers).length;
      const neinCount = Object.values(answers).filter(answer => answer === 'nein').length;
      const jaCount = Object.values(answers).filter(answer => answer === 'ja').length;
      const nichtVorhandenCount = Object.values(answers).filter(answer => answer === 'nicht_vorhanden').length;

      const datum = document.getElementById('datum')?.value || 'kein Datum';
      const markt = document.getElementById('markt')?.value || 'unbekannt';
      const name = document.getElementById('name')?.value || 'unbekannt';
      const sifa = document.getElementById('sifa')?.value || 'unbekannt';

      const auswertungContainer = document.getElementById('auswertung-container'); // Target the container
      const auswertungDiv = document.getElementById('auswertung');
      
      if (auswertungContainer) {
        auswertungContainer.style.display = 'block'; // Make the container visible
      }

      auswertungDiv.innerHTML = `
        <h3>📊 Auswertung</h3>
        <p><strong>Markt:</strong> ${markt}</p>
        <p><strong>Datum:</strong> ${datum}</p>
        <p><strong>Name:</strong> ${name}</p>
        <p><strong>SiFa:</strong> ${sifa}</p>
        <hr style="margin: 16px 0;">
        <p><strong>Ja:</strong> ${jaCount}</p>
        <p><strong>Nein:</strong> ${neinCount}</p>
        <p><strong>Nicht vorhanden:</strong> ${nichtVorhandenCount}</p>
        <p><strong>Beantwortet gesamt:</strong> ${answeredQuestions}</p>
        <p><strong>Fragen gesamt:</strong> 97</p>
      `;
    }

    // This function is no longer used for populating the measures table,
    // but kept in case 'defizite.html' still expects rephrased questions.
    function umformulieren(frage) {
      const original = frage.trim();
      const lower = original.toLowerCase();
      let umformuliert = "";

      // Spezifische Fallregeln (formell)
      if (lower.includes("geprüft") && lower.includes("ordnungsgemäß")) {
        umformuliert = "Die Einrichtung wurde nicht geprüft oder befindet sich nicht in ordnungsgemäßem Zustand: " + frageVerneinen(original);
      } else if (lower.includes("beschädigung") || lower.includes("defekt") || lower.includes("nicht funktionsfähig")) {
        umformuliert = "Es liegen erkennbare technische Mängel oder Beschädigungen vor: " + frageVerneinen(original);
      } else if (lower.includes("funktionsfähig") || lower.includes("funktion")) {
        umformuliert = "Die Funktionsfähigkeit ist nicht gewährleistet: " + frageVerneinen(original);
      } else if (lower.includes("frei zugänglich") || lower.includes("nicht zugänglich") || lower.includes("zugestellt")) {
        umformuliert = "Der uneingeschränkte Zugang ist nicht sichergestellt: " + frageVerneinen(original);
      } else if (lower.includes("gekennzeichnet") && lower.includes("sichtbar")) {
        umformuliert = "Kennzeichnung ist unzureichend oder nicht sichtbar: " + frageVerneinen(original);
      } else if (lower.includes("schuhwerk") || lower.includes("schutzbrille") || lower.includes("handschuhe")) {
        umformuliert = "PSA wird nicht bereitgestellt oder nicht ordnungsgemäß verwendet: " + frageVerneinen(original);
      } else if (lower.includes("sicherheitsmesser")) {
        umformuliert = "Verwendung von Sicherheitsmessern ist nicht sichergestellt: " + frageVerneinen(original);
      } else if (lower.includes("feuerlöscher") || lower.includes("feuerlöscheinrichtung")) {
        umformuliert = "Funktionssicherheit oder Zugänglichkeit der Feuerlöscher ist nicht gegeben: " + frageVerneinen(original);
      } else if (lower.includes("brandschutztür") || lower.includes("türhaltevorrichtung")) {
        umformuliert = "Brandschutzeinrichtungen entsprechen nicht den Anforderungen: " + frageVerneinen(original);
      } else if (lower.includes("notausgang") || lower.includes("fluchtweg")) {
        umformuliert = "Die sichere Nutzung der Fluchtwege ist nicht gewährleistet: " + frageVerneinen(original);
      } else if (lower.includes("unterwiesen") || lower.includes("eingearbeitet")) {
        umformuliert = "Mitarbeitende wurden nicht ordnungsgemäß unterwiesen oder eingearbeitet: " + frageVerneinen(original);
      } else if (lower.includes("ersthelfer") || lower.includes("brandschutzhelfer")) {
        umformuliert = "Personelle Besetzung durch Erst-/Brandschutzhelfer ist nicht gewährleistet: " + frageVerneinen(original);
      } else if (lower.includes("pausen") || lower.includes("überstunden") || lower.includes("rückmeldung")) {
        umformuliert = "Organisatorische Mängel im Bereich Arbeitszeit oder Rückmeldungen bestehen: " + frageVerneinen(original);
      } else if (lower.includes("kommunikation") || lower.includes("entscheidung")) {
        umformuliert = "Kommunikation oder Entscheidungsprozesse sind unzureichend: " + frageVerneinen(original);
      }
      // Allgemeine formelle Regeln
      else if (/^Die |^Der |^Das /i.test(original)) {
        umformuliert = "Es wurde festgestellt, dass " + frageVerneinen(original[0].toLowerCase() + original.slice(1));
      } else if (/^Im |^In |^An |^Auf /i.test(original)) {
        umformuliert = "Die folgende Feststellung trifft nicht zu: " + frageVerneinen(original);
      } else if (original.trim().endsWith("?")) {
        umformuliert = "Die Fragestellung ist aktuell nicht mit 'Ja' zu beantworten: " + frageVerneinen(original);
      } else {
        umformuliert = "Abweichung festgestellt: " + frageVerneinen(original);
      }

      if (!umformuliert.endsWith(".")) {
        umformuliert += ".";
      }
      return umformuliert;
    }

    function frageVerneinen(satz) {
      return satz
        .replace(/\bist\b/g, "ist nicht")
        .replace(/\bsind\b/g, "sind nicht")
        .replace(/\bwurde\b/g, "wurde nicht")
        .replace(/\bwurden\b/g, "wurden nicht")
        .replace(/\bsteht\b/g, "steht nicht")
        .replace(/\bstehen\b/g, "stehen nicht")
        .replace(/\berfolgt\b/g, "erfolgt nicht")
        .replace(/\berfolgen\b/g, "erfolgen nicht")
        .replace(/\bgewährleistet\b/g, "nicht gewährleistet")
        .replace(/\bgesichert\b/g, "nicht gesichert");
    }

    function neinFragenInMaßnahmen() {
      const neinQuestionIds = [];
      for (const questionId in answers) {
        if (answers[questionId] === 'nein') {
          neinQuestionIds.push(questionId);
        }
      }

      const maßnahmenZeilen = document.querySelectorAll("#maßnahmen-tabelle td[contenteditable='true']");
      maßnahmenZeilen.forEach(cell => cell.textContent = ''); // Clear existing content

      let index = 0;
      neinQuestionIds.forEach(qId => {
        if (index < maßnahmenZeilen.length) {
          const measureData = measures[qId];
          if (measureData) {
            maßnahmenZeilen[index].textContent = measureData.text; // Use the actual measure text
            index++;
          }
        }
      });

      if (index === 0) {
        alert("✅ Es wurden keine Fragen mit 'nein' beantwortet.");
      } else if (index >= maßnahmenZeilen.length) {
        alert("⚠️ Mehr als 15 'nein'-Antworten – nur die ersten 15 wurden übernommen.");
      }
    }

    function neinAntwortenEinfügenUndÖffnen() {
      const neinMeasures = [];
      for (const questionId in answers) {
        if (answers[questionId] === 'nein') {
          const measureData = measures[questionId];
          if (measureData) {
            neinMeasures.push(measureData.text); // Push the actual measure text
          }
        }
      }

      const maßnahmenZeilen = document.querySelectorAll('#maßnahmen-tabelle td[contenteditable]');
      maßnahmenZeilen.forEach(cell => cell.textContent = ''); // Clear existing content

      neinMeasures.forEach((text, index) => { // Iterate over actual measure texts
        if (maßnahmenZeilen[index]) {
          maßnahmenZeilen[index].innerText = text; // Insert actual measure text
        }
      });

      const win = window.open('defizite.html', '_blank');
      setTimeout(() => {
        win?.postMessage({ neinAntworten: neinMeasures }, "*"); // Send actual measure texts
      }, 500);
    }

    async function generatePdfAndPrepareShare() {
      const shareButton = document.getElementById('sharePdfButton');
      const statusMessage = document.getElementById('pdfStatusMessage');

      shareButton.disabled = true;
      shareButton.textContent = 'PDF wird erstellt...';
      statusMessage.textContent = 'Bitte warten...';
      statusMessage.style.color = '#666';

      const datum = document.getElementById('datum')?.value || 'kein Datum';
      const markt = document.getElementById('markt')?.value || 'unbekannt';
      const name = document.getElementById('name')?.value || 'unbekannt';
      const sifa = document.getElementById('sifa')?.value || 'unbekannt';
      const signatureDataURL = canvas.toDataURL();

      let pdfContentHtml = `
        <style>
          body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }
          .header-section { padding: 20px; background-color: #f8f9fa; border-bottom: 1px solid #eee; }
          h1 { font-size: 2.2em; margin-bottom: 10px; color: #212529; }
          h2 { font-size: 1.8em; margin-top: 20px; margin-bottom: 10px; color: #2d3748; }
          h3 { font-size: 1.4em; margin-top: 15px; margin-bottom: 10px; color: #2d3748; }
          .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
          .info-item strong { display: block; margin-bottom: 5px; color: #2d3748; }
          .category-frame { border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
          .category-title { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 15px; font-size: 1.2em; font-weight: 600; }
          .question-item { padding: 15px; border-bottom: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 8px; }
          .question-item:last-child { border-bottom: none; }
          .question-text { font-weight: 600; color: #2d3748; font-size: 0.95em; }
          .answer-text { font-weight: normal; margin-left: 10px; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; }
          .answer-ja { background-color: #c6f6d5; color: #2f855a; }
          .answer-nein { background-color: #fed7d7; color: #c53030; }
          .answer-nv { background-color: #e2e8f0; color: #718096; }
          .measure-display { background: #fff5f5; color: #e53e3e; padding: 8px 12px; border-radius: 6px; border-left: 3px solid #e53e3e; font-size: 0.9em; font-weight: 500; margin-top: 5px; }
          .measure-priority-high { background-color: #fed7d7; color: #c53030; padding: 2px 6px; border-radius: 8px; font-size: 0.7em; font-weight: 600; }
          .measure-priority-medium { background-color: #feebc8; color: #dd6b20; padding: 2px 6px; border-radius: 8px; font-size: 0.7em; font-weight: 600; }
          .measure-priority-low { background-color: #c6f6d5; color: #2f855a; padding: 2px 6px; border-radius: 8px; font-size: 0.7em; font-weight: 600; }
          .measures-table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden; }
          .measures-table th { background-color: #e53e3e; color: white; padding: 10px; text-align: left; }
          .measures-table td { padding: 8px; border: 1px solid #dee2e6; text-align: left; }
          .measures-table tr:nth-child(even) { background-color: #f2f2f2; }
          .confirmation-section { background: #fff; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); padding: 20px; margin-top: 30px; }
          .checkbox-row { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 10px; }
          .checkbox-item { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 200px; }
          .signature-area { text-align: center; margin-top: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
          .signature-area img { max-width: 150px; height: auto; border: 1px solid #000; display: block; margin: 10px auto; }
          .footer-pdf { text-align: center; margin-top: 30px; padding: 10px; font-size: 0.7em; color: #999; border-top: 1px solid #eee; }
          .page-break-before { page-break-before: always; }
        </style>
        <div style="padding: 20px;">
          <div class="header-section">
            <h1>Arbeitssicherheit-Checkliste-2025</h1>
            <div class="info-grid">
              <div class="info-item"><strong>Marktnummer:</strong> ${markt}</div>
              <div class="info-item"><strong>Datum:</strong> ${datum}</div>
              <div class="info-item"><strong>Name:</strong> ${name}</div>
              <div class="info-item"><strong>SiFa:</strong> ${sifa}</div>
            </div>
          </div>
          <p style="text-align: center; margin: 20px 0; font-size: 1.1em;">
            <strong>Teil der Gefährdungsbeurteilung / Wirksamkeitskontrolle</strong><br/>
            Wenn eine Frage mit „nein“ beantwortet wurde, besteht Handlungsbedarf.
          </p>
      `;

      // Add questions and answers
      document.querySelectorAll('#questions-container .category-frame').forEach(categoryFrame => {
        const categoryTitle = categoryFrame.querySelector('.category-title')?.textContent || 'Unbekannte Kategorie';
        pdfContentHtml += `<div class="category-frame"><h3 class="category-title">${categoryTitle}</h3>`;
        categoryFrame.querySelectorAll('.question-item').forEach(questionItem => {
          const questionId = questionItem.dataset.questionId;
          const questionText = questionItem.querySelector('.question-text')?.textContent || 'Unbekannte Frage';
          const answer = answers[questionId];
          let answerDisplay = '';
          let answerClass = '';

          if (answer === 'ja') {
            answerDisplay = 'Ja';
            answerClass = 'answer-ja';
          } else if (answer === 'nein') {
            answerDisplay = 'Nein';
            answerClass = 'answer-nein';
          } else if (answer === 'nicht_vorhanden') {
            answerDisplay = 'N.V.';
            answerClass = 'answer-nv';
          }

          pdfContentHtml += `
            <div class="question-item">
              <div class="question-text">${questionText} <span class="answer-text ${answerClass}">Antwort: ${answerDisplay}</span></div>
          `;
          if (answer === 'nein') {
            const measureData = measures[questionId];
            if (measureData) {
              const priorityText = { 'high': 'Hoch', 'medium': 'Mittel', 'low': 'Niedrig' };
              const priorityClass = `measure-priority-${measureData.priority}`;
              pdfContentHtml += `
                <div class="measure-display">
                  <strong>Maßnahme:</strong> ${measureData.text} <span class="${priorityClass}">${priorityText[measureData.priority]}</span>
                </div>
              `;
            }
          }
          pdfContentHtml += `</div>`;
        });
        pdfContentHtml += `</div>`;
      });

      // Add measures table
      pdfContentHtml += `
        <h2 class="page-break-before" style="text-align: center;">Beschreibung der Maßnahmen zur Beseitigung von Defiziten</h2>
        <table class="measures-table">
          <thead>
            <tr>
              <th>Nr.</th>
              <th>Beschreibung</th>
            </tr>
          </thead>
          <tbody>
      `;
      document.querySelectorAll('#maßnahmen-tabelle tbody tr').forEach(row => {
        const nr = row.querySelector('td:first-child')?.textContent || '';
        const beschreibung = row.querySelector('td:last-child')?.textContent || '';
        if (beschreibung.trim() !== '') { // Only add rows with content
          pdfContentHtml += `<tr><td>${nr}</td><td>${beschreibung}</td></tr>`;
        }
      });
      pdfContentHtml += `
          </tbody>
        </table>
      `;

      // Add confirmation section
      const mangelChecked = document.getElementById('mangel')?.checked ? 'checked' : '';
      const massnahmenChecked = document.getElementById('massnahmen')?.checked ? 'checked' : '';
      const nachkontrolleChecked = document.getElementById('nachkontrolle')?.checked ? 'checked' : '';
      const mitarbeiterChecked = document.getElementById('mitarbeiter')?.checked ? 'checked' : '';

      pdfContentHtml += `
        <div class="page-break-before confirmation-section">
          <h2>Abschlussbestätigung</h2>
          <div class="checkbox-row">
            <div class="checkbox-column">
              <div class="checkbox-item">
                <input type="checkbox" ${mangelChecked} disabled style="margin-right: 5px;"/>
                <span>Alle Mängel wurden zur Kenntnis genommen.</span>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" ${massnahmenChecked} disabled style="margin-right: 5px;"/>
                <span>Maßnahmen gemäß Plan werden umgesetzt.</span>
              </div>
            </div>
            <div class="checkbox-column">
              <div class="checkbox-item">
                <input type="checkbox" ${nachkontrolleChecked} disabled style="margin-right: 5px;"/>
                <span>Nachkontrolle wird durchgeführt.</span>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" ${mitarbeiterChecked} disabled style="margin-right: 5px;"/>
                <span>Mitarbeiter wurden informiert.</span>
              </div>
            </div>
          </div>
        </div>
      `;

      // Add signature
      pdfContentHtml += `
        <div class="signature-area">
          <p style="font-weight: bold; margin-bottom: 10px;">Unterschrift</p>
          <img src="${signatureDataURL}" alt="Unterschrift"/>
        </div>
      `;

      // Add footer
      pdfContentHtml += `
        <div class="footer-pdf">
          &copy; 2025 Andreas Zott – Alle Rechte vorbehalten<br>
          <span style="font-size: 0.9em;">(Sifa) Arbeitssicherheit 2025</span>
        </div>
        </div> <!-- End of padding div -->
      `;

      const opt = {
        margin:       [20, 10, 20, 10], // Top, Left, Bottom, Right margins in mm
        filename:     'arbeitssicherheit-checkliste.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, scrollY: 0, useCORS: true, logging: true }, // Added logging for html2canvas
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      try {
        console.log("PDF-Generierung gestartet...");
        const pdfBlob = await html2pdf().set(opt).from(pdfContentHtml).outputPdf('blob');
        console.log("PDF-Blob erfolgreich generiert. Größe:", pdfBlob.size, "Bytes");

        generatedPdfFile = new File([pdfBlob], "arbeitssicherheit-checkliste.pdf", {
          type: "application/pdf",
        });
        console.log("File-Objekt erstellt:", generatedPdfFile);

        if (navigator.canShare && navigator.canShare({ files: [generatedPdfFile] })) {
          shareButton.textContent = '📤 PDF jetzt teilen';
          shareButton.onclick = shareGeneratedPdf; // Change handler to direct share
          statusMessage.textContent = 'PDF bereit zum Teilen.';
          statusMessage.style.color = '#28a745'; // Green
        } else {
          shareButton.textContent = '⬇️ PDF herunterladen';
          shareButton.onclick = downloadGeneratedPdf; // Change handler to direct download
          statusMessage.textContent = 'PDF bereit zum Teilen. Teilen nicht unterstützt. PDF kann heruntergeladen werden.';
          statusMessage.style.color = '#6c757d'; // Gray
        }
      } catch (err) {
        console.error("❌ PDF-Generierung fehlgeschlagen:", err);
        statusMessage.textContent = 'Fehler bei der PDF-Generierung. Bitte versuchen Sie es erneut.';
        statusMessage.style.color = '#e53e3e'; // Red
        shareButton.textContent = '📤 PDF teilen (Fehler)';
        shareButton.onclick = generatePdfAndPrepareShare; // Allow retry
        generatedPdfFile = null; // Clear file
      } finally {
        shareButton.disabled = false;
      }
    }

    async function shareGeneratedPdf() {
      if (!generatedPdfFile) {
        alert("PDF wurde noch nicht generiert oder ein Fehler ist aufgetreten.");
        return;
      }

      const shareButton = document.getElementById('sharePdfButton');
      const statusMessage = document.getElementById('pdfStatusMessage');

      shareButton.disabled = true; // Disable during sharing attempt
      statusMessage.textContent = 'Teilen wird geöffnet...';
      statusMessage.style.color = '#666';

      try {
        console.log("Versuche, generiertes PDF zu teilen...");
        await navigator.share({
          title: 'Checkliste Arbeitssicherheit',
          text: 'Anbei die ausgefüllte Arbeitssicherheits-Checkliste als PDF.',
          files: [generatedPdfFile],
        });
        console.log("✅ Teilen abgeschlossen");
        statusMessage.textContent = 'PDF erfolgreich geteilt!';
        statusMessage.style.color = '#28a745';
      } catch (err) {
        console.error("❌ Teilen abgebrochen oder fehlgeschlagen:", err);
        if (err.name === 'AbortError') {
          statusMessage.textContent = "Teilen abgebrochen.";
          statusMessage.style.color = '#718096'; // Grey
        } else if (err.name === 'NotAllowedError') {
          statusMessage.textContent = "Teilen nicht erlaubt. Stellen Sie sicher, dass die Aktion direkt durch eine Nutzerinteraktion ausgelöst wird.";
          statusMessage.style.color = '#e53e3e'; // Red
        } else {
          statusMessage.textContent = "Ein unerwarteter Fehler beim Teilen ist aufgetreten.";
          statusMessage.style.color = '#e53e3e'; // Red
        }
      } finally {
        shareButton.disabled = false;
        // Reset button to allow re-sharing or re-generating if needed
        shareButton.textContent = '📤 PDF jetzt teilen'; // Or keep 'PDF teilen (iPad)' and reset generatedPdfFile
      }
    }

    function downloadGeneratedPdf() {
      if (!generatedPdfFile) {
        alert("PDF wurde noch nicht generiert oder ein Fehler ist aufgetreten.");
        return;
      }
      console.log("Versuche, generiertes PDF herunterzuladen...");
      const link = document.createElement("a");
      link.href = URL.createObjectURL(generatedPdfFile);
      link.download = "arbeitssicherheit-checkliste.pdf";
      document.body.appendChild(link); // Required for Firefox
      link.click();
      document.body.removeChild(link); // Clean up
      URL.revokeObjectURL(link.href); // Release the object URL
      console.log("✅ Download abgeschlossen");
      document.getElementById('pdfStatusMessage').textContent = 'PDF heruntergeladen.';
      document.getElementById('pdfStatusMessage').style.color = '#28a745';
    }

    // Init
    window.addEventListener("resize", resizeCanvas);
    window.addEventListener("load", () => {
      resizeCanvas();
      restoreSignature();

      const datumsfeld = document.getElementById('datum');
      if (datumsfeld) {
        const heute = new Date().toISOString().split('T')[0];
        datumsfeld.value = heute;
      }
    });

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing, { passive: false });
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', stopDrawing);

    // Service Worker optional
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sicher/sw.js')
          .then(() => console.log("✅ Service Worker registriert"))
          .catch(err => console.error("❌ Service Worker Fehler:", err));
      });
    }
  </script>
</body>
</html>
