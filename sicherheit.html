<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sicherheits-Checkliste</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="/sicher/favicon.ico" rel="icon" type="image/x-icon" />
  <link href="/sicher/manifest-sicher.json" rel="manifest" />
<style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #e6f7ff;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: #f0fbff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
    }
    #header-fields {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
    }
    #header-fields div {
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: bold;
      margin-bottom: 4px;
    }
    input {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 150px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #333;
      padding: 6px;
      vertical-align: top;
    }
    th {
      background-color: #d9f2ff;
    }
    .checkbox {
      width: 20px;
      text-align: center;
    }
    .checkbox input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }
    textarea {
      width: 100%;
      height: 2em;
    }
    .btn {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px;
      width: 100%;
      margin: 20px 0;
      font-size: 1em;
      cursor: pointer;
    }
    .btn.green { background-color: #28a745; }
    .btn.red { background-color: #dc3545; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sicherheits- und Betriebs-Checkliste</h1>

    <div id="header-fields">
      <div>
        <label for="date">Datum</label>
        <input type="text" id="date" readonly />
      </div>
      <div>
        <label for="marktnummer">Marktnummer</label>
        <input type="text" id="marktnummer" placeholder="Eingabe..." />
      </div>
      <div>
        <label for="sifa">Sicherheitsbeauftragter</label>
        <input type="text" id="sifa" placeholder="Eingabe..." />
      </div>
    </div>

    <table id="checklist">
      <thead>
        <tr>
          <th>Nr.</th>
          <th>Pr√ºffrage</th>
          <th class="checkbox">Ja</th>
          <th class="checkbox">Nein</th>
          <th>Bemerkung</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- PDF Teilen Button -->
    <button id="sharePdfBtn" class="btn green">üì§ PDF teilen / drucken (iPad Safari)</button>

    <!-- Seite neu laden -->
    <button onclick="window.location.reload();" class="btn red">üîÑ Seite neu laden</button>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('date').value = new Date().toLocaleDateString('de-DE');

      const fragen = [
        "Werden Technik- und Heizr√§ume als Lagerr√§ume genutzt?",
        "Befindet sich brennbares Material (z.‚ÄØB. Kisten, Kartons) in den Technik- oder Heizr√§umen?",
        "Sind die Treppen unbesch√§digt und frei von Gegenst√§nden?",
        "Sind die Verkehrswege so beschaffen, dass kein Risiko zum Stolpern, Ausrutschen oder Umknicken besteht?",
        "Wird im gesamten Markt geeignetes Schuhwerk getragen (feste, geschlossene, flache Schuhe)?",
        "Sind Automatikt√ºren, Rolltore und Schnelllauftore gepr√ºft und ohne sichtbare Besch√§digungen?",
        "Ist die Aufzugsanlage gepr√ºft und in einem ordnungsgem√§√üen Zustand (keine sichtbare Besch√§digung, funktionsf√§hige Schutzeinrichtungen)?",
        "Ist die Leergutr√ºcknahme in einem ordnungsgem√§√üen Zustand (intakte Schutzeinrichtungen, gesicherte Einzugsstellen, keine Glasscherben)?",
        "Stehen geeignete Handschuhe f√ºr die Leergutr√ºcknahme zur Verf√ºgung?",
        "Sind Leitern gepr√ºft gem√§√ü 'Leitern und Tritte' (BGV D36 bzw. GUV-VD360)?",
        "Ist das Leiter-Kontrollblatt im Ordner Arbeitssicherheit abgelegt?",
        "Werden aus dem Ordersatz geeignete Sicherheitsmesser verwendet?",
        "Sind zur Zeit der Begehung keine sichtbaren Besch√§digungen an Schaltern und Steckdosen vorhanden?",
        "Ist der Gabelhubwagen in einem ordnungsgem√§√üen Zustand ohne sichtbare Besch√§digungen?",
        "Ist der elektrische Hubwagen gepr√ºft und in einem ordnungsgem√§√üen Zustand (keine sichtbaren Besch√§digungen, funktionsf√§hige Schutzeinrichtungen)?",
        "Ist der elektrische Hubwagen gegen unbefugte Benutzung gesichert?",
        "Werden Sicherheitsschuhe getragen?",
        "Sind die Feuerl√∂scheinrichtungen frei zug√§nglich und nicht blockiert?",
        "Sind die Feuerl√∂scheinrichtungen gepr√ºft und werden Pr√ºffristen eingehalten?",
        "Sind Brandschutzt√ºren frei von Zugestellungen und wird ihre Funktion nicht gest√∂rt?",
        "Sind T√ºrhaltevorrichtungen und Schlie√üfolgeregler des Feuerschutzabschlusses in Ordnung?",
        "Sind Brandschutzt√ºren ohne Besch√§digungen?",
        "Ist ein aktueller Flucht- und Rettungsplan vorhanden?",
        "Ist die Notausgangsbeleuchtung ohne Defekte?",
        "Sind Notausg√§nge frei zug√§nglich und nicht zugestellt?",
        "Sind Notausg√§nge und -ausstiege von innen ohne fremde Hilfe zu √∂ffnen und nicht zugestellt?",
        "F√ºhren Notausg√§nge in sichere Bereiche?",
        "Wird passende pers√∂nliche Schutzausr√ºstung f√ºr T√§tigkeiten mit Gefahrstoffen (z.B. Schutzbrille, Handschuhe) gestellt?",
        "Sind Betriebsanweisungen gut zug√§nglich?",
        "Werden Sicherheitsanweisungen eingehalten?",
        "Sind die Arbeitsger√§te an der Backstation (Backofen, Backbleche, Brotschneidemaschine) in einem ordnungsgem√§√üen Zustand?",
        "Sind Elektroleitungen intakt und bilden keine Stolperstellen?",
        "Ist das freistehende Handwaschbecken ohne Besch√§digungen?",
        "Entspricht die Zuleitung der VDE-Norm?",
        "Ist der Backhandschuh f√ºr die Backstation in einem ordnungsgem√§√üen Zustand (kein Verschlei√ü) und besitzt eine lange Stulpe?",
        "Sind alle Hei√üger√§te (z.B. Hei√ütheken, Fritteusen) in technisch einwandfreiem Zustand?",
        "H√§ngt der Hautschutzplan aus?",
        "Werden Hautschutz- und Hautpflegeprodukte zur Verf√ºgung gestellt?",
        "Sind die Arbeitsger√§te im Servicebereich in einem ordnungsgem√§√üen Zustand?",
        "Sind Glast√ºren und Glasw√§nde in Augenh√∂he gekennzeichnet?",
        "Werden Schneidbretter und Messer regelm√§√üig gereinigt und farbcodiert verwendet?",
        "Werden Schneidbretter mit Messereinschub verwendet?",
        "Werden Messerhalter verwendet?",
        "Sind Convenience-Ger√§te in einem ordnungsgem√§√üen Zustand?",
        "Ist der Fu√üboden im Kassenbereich ohne sichtbare Besch√§digungen?",
        "Ist der Fu√üraum frei von Gegenst√§nden?",
        "Ist das Transportband unbesch√§digt und weist keine L√ºcke von √ºber 5mm auf?",
        "Sind die Kassenst√ºhle in einem funktionsf√§higen Zustand?",
        "Sind die serienm√§√üig eingebauten Heizger√§te im Kassenraum nicht durch brennbares Material zugestellt?",
        "Ist in den K√ºhlh√§usern an der Beleuchtung die √úberglocke vorhanden?",
        "Ist die Notentriegelung an K√ºhlhaust√ºren vorhanden und in Ordnung?",
        "Sind die K√ºhlhaust√ºren von innen mit dem Rettungswegschild ISO7010 gekennzeichnet?",
        "Funktioniert die Beleuchtung einwandfrei?",
        "Ist die Notruf-Funktion (wenn vorhanden) in Ordnung und ohne Besch√§digungen?",
        "Sind Schwerlastregale gepr√ºft?",
        "Ist der Anfahrschutz an den Schwerlastregalen vorhanden?",
        "Ist die Traglastangabe an den Schwerlastregalen vorhanden?",
        "Befindet sich eine Absturzsicherung an der Rampe?",
        "Ist die Absturzsicherung an der Rampe in einem ordnungsgem√§√üen Zustand (keine sichtbaren Besch√§digungen, Kennzeichnung)?",
        "Ist die M√ºll-/Papierpresse gepr√ºft?",
        "Ist die M√ºll-/Papierpresse in einem ordnungsgem√§√üen Zustand (keine sichtbaren Besch√§digungen, intakte Schutzeinrichtungen, fester Stand)?",
        "Liegen die aushangpflichtigen Gesetze, Unfallverh√ºtungsvorschriften und Brandschutzordnung Teil A im Sozialbereich aus?",
        "Sind Kaffeemaschine und andere hitzeentwickelnde Ger√§te auf einer nicht brennbaren Unterlage abgestellt?",
        "Ist der Erste-Hilfe-Koffer gut sichtbar an einer geeigneten Stelle montiert?",
        "Werden ortsver√§nderliche elektrische Betriebsmittel in angemessenen Zeitabst√§nden gepr√ºft?",
        "Liegt eine aktuelle Liste sowie Pr√ºfberichte pr√ºfungsbed√ºrftiger Einrichtungen vor?",
        "Ist der Verbandskasten in einem ordnungsgem√§√üen Zustand?",
        "Wird die Dokumentation √ºber Erste Hilfeleistungen gef√ºhrt?",
        "Sind Ma√ünahmen getroffen, die den Anreiz zu Raub√ºberf√§llen vermindern (z.B. T√ºrspion, feststehender Knauf)?",
        "Ist die T√ºr w√§hrend des Umgangs mit Zahlungsmitteln verschlossen?",
        "Werden neue Mitarbeiter vor Aufnahme der T√§tigkeit zum Thema Arbeitssicherheit und Brandschutz unterwiesen?",
        "Ist w√§hrend der gesamten Laden√∂ffnungszeit mindestens ein Mitarbeiter mit der Qualifikation zum Ersthelfer anwesend?",
        "Ist w√§hrend der gesamten Laden√∂ffnungszeit mindestens ein Mitarbeiter mit der Qualifikation als Brandschutzhelfer anwesend?",
        "Ist ein Sicherheitsbeauftragter ausgebildet und bestellt?",
        "Wurde die Gef√§hrdungsbeurteilung (GBO) erstellt und ist sie auf dem aktuellen Stand?",
        "Wurden Personen, die sich im Bereich von K√ºhlanlagen oder K√ºhlh√§usern aufhalten, unterwiesen?",
        "Sind die Sensoren nicht mit Material oder sonstigen Gegenst√§nden verstellt?",
        "Sind alle Sicherheitsvorrichtungen (Alarmleuchten, Kennzeichnungen, K√ºhlhaust√ºren) intakt?",
        "Wurde die Unterweisung von Praktikanten und Sch√ºleraushilfen durchgef√ºhrt?",
        "Haben die Personen die Inhalte der Unterweisung verstanden?",
        "Wurde die Unterweisung schriftlich dokumentiert?",
              "Wird die Unterweisung regelm√§√üig wiederholt?",
      "Sind die Arbeitspl√§tze ordentlich und sauber?",
      "Werden Sicherheitskennzeichen und Hinweise gut sichtbar angebracht?",
      "Sind die Fluchtwege frei und gut beleuchtet?",
      "Ist die Beleuchtung in allen Arbeitsbereichen ausreichend?",
      "Werden geeignete Schutzkleidung und PSA getragen?",
      "Sind Arbeitsmittel regelm√§√üig gepr√ºft und gewartet?",
      "Gibt es Ma√ünahmen zur Vermeidung von Arbeitsunf√§llen?",
      "Sind alle Mitarbeiter √ºber Notfallma√ünahmen informiert?",
      "Sind Brandschutzeinrichtungen zug√§nglich und einsatzbereit?",
      "Werden Gefahrstoffe ordnungsgem√§√ü gelagert und gekennzeichnet?",
      "Sind die M√ºllentsorgungsbeh√§lter sicher und sauber?",
      "Sind L√§rmschutzma√ünahmen umgesetzt?",
      "Werden Arbeitszeiten und Pausenregelungen eingehalten?",
      "Sind ergonomische Arbeitspl√§tze gew√§hrleistet?",
      "Wird auf den Schutz vor psychischer Belastung geachtet?",
      "Gibt es Ma√ünahmen zur Unfallverh√ºtung bei besonderen Gef√§hrdungen?",
      "Sind alle Maschinen mit erforderlichen Schutzvorrichtungen ausgestattet?",
      "Wird die Sicherheit bei Arbeiten in der H√∂he gew√§hrleistet?",
      "Sind Notfallpl√§ne f√ºr verschiedene Szenarien vorhanden?",
      "Werden regelm√§√üige Unterweisungen durchgef√ºhrt?",
      "Ist das Erste-Hilfe-Team vollst√§ndig und einsatzbereit?",
      "Gibt es ein Verfahren zur Meldung von Beinahe-Unf√§llen?",
      "Wird die Dokumentation der Sicherheitsma√ünahmen gef√ºhrt?"
    ];

    const tbody = document.querySelector('#checklist tbody');

    fragen.forEach((frage, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${frage}</td>
        <td class="checkbox"><input type="checkbox" name="ja${index}" /></td>
        <td class="checkbox"><input type="checkbox" name="nein${index}" /></td>
        <td><textarea name="bemerkung${index}" placeholder="Bemerkung..."></textarea></td>
      `;
      tbody.appendChild(tr);
    });

    // Damit nicht gleichzeitig Ja und Nein angekreuzt werden k√∂nnen
    tbody.addEventListener('change', e => {
      if (e.target.type === 'checkbox') {
        const name = e.target.name;
        const isJa = name.startsWith('ja');
        const idx = name.replace(/\D/g, '');
        const andereCheckbox = isJa ? document.querySelector(`input[name="nein${idx}"]`) : document.querySelector(`input[name="ja${idx}"]`);
        if (e.target.checked && andereCheckbox.checked) {
          andereCheckbox.checked = false;
        }
      }
    });

    // PDF Erstellen und Teilen Funktion
    const { jsPDF } = window.jspdf;

    document.getElementById('sharePdfBtn').addEventListener('click', async () => {
      try {
        const doc = new jsPDF('p', 'mm', 'a4');
        const margin = 10;
        const lineHeight = 7;
        const pageWidth = doc.internal.pageSize.getWidth();
        let y = margin;

        doc.setFontSize(16);
        doc.text("Sicherheits- und Betriebs-Checkliste", pageWidth / 2, y, { align: 'center' });
        y += 10;

        doc.setFontSize(11);
        doc.text(`Datum: ${document.getElementById('date').value}`, margin, y);
        doc.text(`Marktnummer: ${document.getElementById('marktnummer').value}`, margin + 70, y);
        doc.text(`Sicherheitsbeauftragter: ${document.getElementById('sifa').value}`, margin + 140, y);
        y += 10;

        doc.setFontSize(9);

        // Tabellenkopf
        const headers = ['Nr.', 'Pr√ºffrage', 'Ja', 'Nein', 'Bemerkung'];
        const colWidths = [10, 110, 10, 10, 50];

        // Kopfzeile zeichnen
        let x = margin;
        headers.forEach((header, i) => {
          doc.rect(x, y, colWidths[i], lineHeight, 'S');
          doc.text(header, x + 2, y + 5);
          x += colWidths[i];
        });
        y += lineHeight;

        const rowsPerPage = Math.floor((doc.internal.pageSize.getHeight() - y - margin) / lineHeight);

        const rows = fragen.map((frage, index) => {
          const jaChecked = document.querySelector(`input[name="ja${index}"]`).checked ? "X" : "";
          const neinChecked = document.querySelector(`input[name="nein${index}"]`).checked ? "X" : "";
          const bemerkung = document.querySelector(`textarea[name="bemerkung${index}"]`).value || "";
          return [String(index + 1), frage, jaChecked, neinChecked, bemerkung];
        });

        for (let i = 0; i < rows.length; i++) {
          if ((i % rowsPerPage === 0) && i !== 0) {
            doc.addPage();
            y = margin;
            // Tabelle Kopfzeile auf neuer Seite
            x = margin;
            headers.forEach((header, i) => {
              doc.rect(x, y, colWidths[i], lineHeight, 'S');
              doc.text(header, x + 2, y + 5);
              x += colWidths[i];
            });
            y += lineHeight;
          }

          const row = rows[i];
          x = margin;
          for (let j = 0; j < row.length; j++) {
            doc.rect(x, y, colWidths[j], lineHeight, 'S');

            // Text Wrapping f√ºr Pr√ºffrage und Bemerkung
            if (j === 1 || j === 4) {
              const text = doc.splitTextToSize(row[j], colWidths[j] - 4);
              doc.text(text, x + 2, y + 5);
            } else {
              doc.text(row[j], x + 5, y + 5);
            }
            x += colWidths[j];
          }
          y += lineHeight;
        }

        // PDF als Blob erzeugen
        const pdfBlob = doc.output('blob');

        if (navigator.canShare && navigator.canShare({ files: [new File([pdfBlob], "Checkliste.pdf", { type: "application/pdf" })] })) {
          await navigator.share({
            title: "Sicherheits-Checkliste",
            files: [new File([pdfBlob], "Checkliste.pdf", { type: "application/pdf" })],
          });
        } else {
          // Fallback: PDF herunterladen
          doc.save("Checkliste.pdf");
          alert("Teilen wird auf Ihrem Ger√§t nicht unterst√ºtzt. PDF wurde zum Download gespeichert.");
        }
      } catch (error) {
        alert("Fehler bei der PDF-Erstellung: " + error);
      }
    });
  });
 // Service Worker optional
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sicher/sw.js')
        .then(() => console.log("‚úÖ Service Worker registriert"))
        .catch(err => console.error("‚ùå Service Worker Fehler:", err));
    });
  }
  </script>
</body>
</html>