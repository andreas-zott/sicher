<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Checkliste Arbeitssicherheit</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px;
      word-break: break-word;
      vertical-align: top;
    }
    th {
      background-color: #f0f0f0;
    }
    input[type="radio"] {
      transform: scale(1.2);
    }
    #vorschauContainer img {
      max-height: 100px;
      margin: 5px;
    }
  </style>
</head>
<body>

<form id="formular">
  <label>Datum: <input type="date" id="datum" required></label><br>
  <label>Marktnummer: <input type="text" id="marktnummer" required></label><br>
  <label>Name: <input type="text" id="name" required></label><br>
  <label>SiFa: <input type="text" id="sifa" required></label><br>

  <table id="fragenTabelle">
    <tr>
      <th>Frage</th>
      <th>Ja</th>
      <th>Nein</th>
      <th>Nicht vorhanden</th>
    </tr>
    <tr>
      <td>Wird Alleinarbeit vermieden?</td>
      <td><input type="radio" name="frage1" value="ja"></td>
      <td><input type="radio" name="frage1" value="nein"></td>
      <td><input type="radio" name="frage1" value="nicht_vorhanden"></td>
    </tr>
    <tr>
      <td>Gibt es eine regelmäßige Sicherheitsunterweisung?</td>
      <td><input type="radio" name="frage2" value="ja"></td>
      <td><input type="radio" name="frage2" value="nein"></td>
      <td><input type="radio" name="frage2" value="nicht_vorhanden"></td>
    </tr>
    <!-- Weitere Fragen hier -->
  </table>

  <h3>Bilder anhängen</h3>
  <input type="file" id="uploadInput" accept="image/*" multiple>
  <div id="vorschauContainer"></div>

  <button type="button" onclick="speichernAlsPDF()">PDF speichern</button>
</form>

<script>
  const uploadInput = document.getElementById("uploadInput");
  const vorschauContainer = document.getElementById("vorschauContainer");
  let bilder = [];

  uploadInput.addEventListener("change", function (event) {
    const files = event.target.files;
    for (const file of files) {
      if (file && file.type.startsWith("image/") && bilder.length < 16) {
        const reader = new FileReader();
        reader.onload = function (e) {
          bilder.push(e.target.result);
          renderVorschau();
        };
        reader.readAsDataURL(file);
      }
    }
    event.target.value = "";
  });

  function renderVorschau() {
    vorschauContainer.innerHTML = "";
    bilder.forEach((src) => {
      const img = document.createElement("img");
      img.src = src;
      vorschauContainer.appendChild(img);
    });
  }

  async function speichernAlsPDF() {
    const datum = document.getElementById("datum").value.trim();
    const marktnummer = document.getElementById("marktnummer").value.trim();
    const name = document.getElementById("name").value.trim();
    const sifa = document.getElementById("sifa").value.trim();

    if (!datum || !marktnummer || !name || !sifa) {
      alert("Bitte fülle alle Pflichtfelder aus.");
      return;
    }

    const element = document.getElementById("formular");

    await html2pdf()
      .set({
        margin: [10, 10, 10, 10],
        filename: `Checkliste-${datum}.pdf`,
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
      })
      .from(element)
      .save();

    document.getElementById("formular").reset();
    bilder = [];
    renderVorschau();
  }

  document.getElementById("datum").valueAsDate = new Date();
</script>

</body>
</html>
